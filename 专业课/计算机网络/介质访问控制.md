[TOC]

# 数据链路层概述

## 主要工作

+ 错误识别
+ 网络拓扑
+ 流量控制

## 物理层与数据链路层的区别

![image-20220709141822056](https://raw.githubusercontent.com/Alemdx/pic-bed/master/linear/image-20220709141822056.png)

## 数据链路提供的服务

+ 无确认的无链接服务
  + 运用于实时通信
  + 误码率较低的通道
  + 大多适用于局域网
  + 不负责重发
+ 有确认的无链接服务
  + 收到信号就发送确认
  + 未收到信号，重传丢失的帧
  + 适用于无线通信
+ 有确认的链接服务
  + 建立链路
  + 传输 
  + 释放链路

## 数据链路层的结构

IEEE将数据链路层分为两部分：(我理解为一个是向下一个是向上)

1. **介质访问控制(MAC)(转换为媒体)**
2. **逻辑链路控制(LLC)(过渡到网络层)**

## 常见的局域网介质访问控制

+ 以太网
  + **逻辑总线型**，物理星型或者扩展星型
+ 令牌环
  + 逻辑环形拓扑，物理星型
+ FDDI
  + 逻辑环形，物理拓扑是双环

# 介质访问控制

## 静态划分信道

基于多路复用技术划分资源

网络负载重，信道效率高

网络负载轻，信道效率低

#### FDM

#### TDM

#### WDM

#### CDM

## 动态分配信道

### 轮询访问介质访问控制

主节点轮流“邀请”从属节点发送数据

问题：1.轮询开销2、等待延迟（后面的主机要等）3、单点故障（有一个节点寄了）

#### 令牌传递协议

是环形结构，物理上是星型的

令牌是特殊形式的MAC控制帧，不包含任何信息。控制信道的使用，确保同一时刻只有一个结点独占信道

用于负载较重、通信量较大的网络中

### 随机访问介质访问控制

在网络负载重的情况下会产生开销

网络负载轻，信道效率高

会产生冲突开销

#### ALOHA

背景：广播当中同时只能有一个发送信息，否则会发送冲突

1. Pure ALOHA: 纯ALOHA协议
   + 主机任何时候都可以发送数据
   + 如果发生冲突，延迟一段时间再发送
2. Slotted ALOHA: 分段ALOHA协议
   + 把信道在时间上分段。主机任何时候都发送数据，但是必须等待下一个时间分段的开始才开始发送
   + 如果发生冲突，延迟一段时间再发送

#### CSMA

发送前先监听下信道

#### **CSMA/CD**

运用于有线网络（总线式以太网），碰撞检测

在发送数据前和**发送数据时**都要检测是否有其他计算机在发送

+ 只要经过2t的时间还没检测到碰撞，就肯定这次的发送不会发送碰撞。t是单程端到端传播时延。

##### 如何确定重传的时机？

截断二进制指数规避算法

+ 确定一个基本退避时间为争用期2t
+ 定义参数K，k等于已经重传的次数。K取和10比较的最小值

![image-20220709114014853](https://raw.githubusercontent.com/Alemdx/pic-bed/master/linear/image-20220709114014853.png)

##### 最小帧长问题

2t* 数据的传输速率

#### **CSMA/CA**

运用于无线局域网络，碰撞避免

##### 为什么要有CA协议？

+ 无法做到360 全面碰撞检测
+ 隐蔽站的问题

##### 工作原理

+ 检测信道是否空闲
+ 空闲发送RTS
+ 接收端收到RTS，回复CTS
+ 发数据，同时预约信道，告诉其他站点自己要使用多久
+ 接收端收到数据帧后，检验是否正确，正确则相应ACK帧
+ 收到ACK，发送下一个数据帧

1、预约信道2、ACK确认帧3、RTS和CTS帧（解决隐蔽站）

##### CSMA/CD与CSMA/CA的相同点和不同点

相同点：都是先听再说

不同点：

+ 传输介质不同
+ 载波检测的方式不同
+ 一个是检测冲突，一个是避免冲突

# 局域网

**以太网是在局域网内的传输数据的方法和模式。**

https://www.jianshu.com/p/1a6d653163ed

## 2.1.2. MAC & LLC

1. MAC子层(802.3)
   + 定义如何在物理线路上传输帧(frames)
   + 处理物理寻址
   + 定义网络拓扑
   + 定义线路规则(discipline)
2. LLC 子层(802.2)
   + **逻辑上标识不同的协议类型，然后将其封装，兼容不同介质的访问**
   + 使用SAP标识符执行逻辑标识，用来做发送的位置的标识
   + LLC帧的类型取决于上层协议期望的标识符，对于上层服务进行支持
   + LLC已经比较规范了，后来有的厂商已经放弃继续做

## 以太网的MAC帧

1. **以字节为单位**进行帧结构描述
2. 有802.3的规范和以太网的规范
3. MAC 介质访问控制子层的帧结构

![](https://raw.githubusercontent.com/Alemdx/pic-bed/master/linear/5.png)

具体解释可以看zhy学长的。

## LLC 逻辑链路控制子层

+ 支持无连接和面向链接的服务
+ 将上层网络层的Package进行封装，交给MAC层
+ 添加了两个协议
  + 目标服务访问点(DSAP)
  + 源服务访问点(SSAP)

# 链路层设备

## NICs

网卡

## Bridges

根据MAC帧的目的地址对帧进行转发和过滤。（并不是向所有的接口转发此帧）

优点：

+ 增大吞吐量
+ 扩大物理范围
+ 提高可靠性
+ 可以连接不同物理层

### 透明网桥

### 源路由网桥

## Switches

多接口网桥

### 直通式交换机

### 存储转发式交换机

# 补充

## 多路复用技术

复用器->共享信道->分用器

## 冲突域与广播域

交换机的每一个端口都是一个冲突域。

链路层设备只能隔离冲突域，不能隔离广播域。

![image-20220709133353212](https://raw.githubusercontent.com/Alemdx/pic-bed/master/linear/image-20220709133353212.png)

![image-20220709133527226](https://raw.githubusercontent.com/Alemdx/pic-bed/master/linear/image-20220709133527226.png)